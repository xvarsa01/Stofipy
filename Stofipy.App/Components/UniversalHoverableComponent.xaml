<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                             xmlns:converters="using:Stofipy.App.Converters"
                             x:Class="Stofipy.App.Components.UniversalHoverableComponent"
                             x:Name="Root">
    <ContentView.Resources>
        <converters:PlayOrPauseTextIconFromCurrentStateConverter x:Key="PlayOrPauseTextIconFromCurrentStateConverter" />
        <converters:IsPlayingToColorConverter x:Key="IsPlayingToColorConverter" />
    </ContentView.Resources>
    
    <Border x:Name="MainBorder"
            Style="{StaticResource RoundedComponent}">
        
        <Border.GestureRecognizers>
            <PointerGestureRecognizer
                PointerEntered="OnPointerEntered"
                PointerExited="OnPointerExited"/>
            <TapGestureRecognizer
                Command="{Binding TapCommand, Source={x:Reference Root}}"
                CommandParameter="{Binding CommandParameter, Source={x:Reference Root}}"/>
        </Border.GestureRecognizers>
        

        <Grid ColumnDefinitions="50, *, 50"
              ColumnSpacing="10"
              Padding="5">
            <Border
                Grid.Column="0" 
                StrokeThickness="0"
                StrokeShape="RoundRectangle 5">
                <Grid>
                    <Image 
                        Source="{Binding Picture, Source={x:Reference Root}}"
                        Aspect="AspectFill"
                        HeightRequest="50"
                        WidthRequest="50"/>

                    <BoxView Grid.Row="0"
                             x:Name="OverlayOverPicture"
                             Opacity="0.5"
                             Color="Black" 
                             IsVisible="False"/>

                    <Border x:Name="PlayButtonOverPicture"
                            Style="{StaticResource TransparentBorderThickness0}" 
                            IsVisible="False"
                            VerticalOptions="Center">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PlayClickedCommand, Source={x:Reference Root}}"
                                                  CommandParameter="{Binding CommandParameter, Source={x:Reference Root}}" />
                        </Border.GestureRecognizers>
                        <Label Style="{StaticResource GeneralText}"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               FontSize="20"
                               TextColor="{StaticResource TextWhite}">
                            <Label.Text>
                                <MultiBinding Converter="{StaticResource PlayOrPauseTextIconFromCurrentStateConverter}">
                                    <Binding Path="IsNowPlayingComponent" Source="{x:Reference Root}" />
                                    <Binding Path="IsPlaying" Source="{x:Reference Root}" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                    </Border>
                </Grid>
            </Border>
            
            <Grid
                Grid.Column="1"
                RowDefinitions="*, *">
                <Label
                    Grid.Row="0"
                    VerticalOptions="Center"
                    HorizontalOptions="Start"
                    Text="{Binding TopText, Source={x:Reference Root}}"
                    TextColor="{Binding Source={x:Reference Root}, Path=IsNowPlayingComponent, Converter={StaticResource IsPlayingToColorConverter}}"
                    Style="{StaticResource TitleSmall}"/>
                <Label Grid.Row="1"
                       VerticalOptions="Center"
                       HorizontalOptions="Start"
                       Text="{Binding BottomText, Source={x:Reference Root}}"
                       TextColor="{StaticResource TextDarkerWhite}"
                       Style="{StaticResource OpenAuthorDetailLink}">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding Source={x:Reference Root}, Path=BottomTextTapCommand}"
                                              CommandParameter="{Binding CommandParameter, Source={x:Reference Root}}"/>
                    </Label.GestureRecognizers>
                </Label>
            </Grid>
            
            <Border Grid.Column="2"
                    x:Name="ShowMoreOptions"
                    Style="{StaticResource TransparentBorderThickness0}"
                    IsVisible="False"
                    VerticalOptions="Center">
        
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding DotsClickedCommand, Source={x:Reference Root}}"
                                          CommandParameter="{Binding CommandParameter, Source={x:Reference Root}}" />
                </Border.GestureRecognizers>
                <Image
                    Aspect="AspectFill"
                    HeightRequest="15"
                    WidthRequest="15"
                    Source="dots_3_white.png">
                </Image>
            </Border>
        </Grid>

    </Border>
</ContentView>